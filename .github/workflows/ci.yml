name: ğŸš€ Build & Validate

on:
  repository_dispatch:
    types: [ libs-versions-updated ]
  pull_request:
    paths:
      - '**/*'
      - '!**/.github/workflows/**'
  workflow_dispatch:
  
jobs:
  lint:
    name: ğŸ” Lint & Code Style Check
    runs-on: ubuntu-latest
    steps:
      - name: âŒ Cancel previous runs
        uses: styfle/cancel-workflow-action@0.12.1
        with:
          access_token: ${{ github.token }}
          
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v5

      - name: âœ… Validate Gradle Wrapper
        uses: gradle/actions/wrapper-validation@v5

      - name: ğŸ—ï¸ Set up JDK 17
        uses: actions/setup-java@v5
        with:
          java-version: 17
          distribution: 'temurin'
          cache: gradle
      
      - name: Give permission to executable
        run: chmod +x gradlew
        
      - name: âš™ï¸ Setup Gradle
        uses: gradle/actions/setup-gradle@v5

      - name: ğŸ§¼ Run Spotless Check
        run: bash ./gradlew spotlessCheck --no-configuration-cache

  build:
    name: ğŸ—ï¸ Build & Compile
    needs: lint  # Only runs if lint passes âœ…
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - name: âŒ Cancel previous runs
        uses: styfle/cancel-workflow-action@0.12.1
        with:
          access_token: ${{ github.token }}
          
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v5

      - name: ğŸ—ï¸ Set up JDK 17
        uses: actions/setup-java@v5
        with:
          java-version: 17
          distribution: 'temurin'
          cache: gradle

      - name: Give permission to executable
        run: chmod +x gradlew
        
      - name: âš™ï¸ Setup Gradle
        uses: gradle/actions/setup-gradle@v5
        
      - name: ğŸ§¹ Clean Project
        run: bash ./gradlew clean

      - name: ğŸ”¨ Build Project
        run: bash ./gradlew build

      - name: ğŸ”¨ Generate APK
        run: bash ./gradlew assembledebug

      - name: â¤´ï¸ Upload APK
        uses: actions/upload-artifact@master
        with:
          name: app-debug
          path: app/build/outputs/apk/debug/app-debug.apk